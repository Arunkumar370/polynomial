import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;

import java.io.File;
import java.math.BigInteger;
import java.util.*;

public class Main {

    static class Point {
        BigInteger x;
        BigInteger y;

        Point(BigInteger x, BigInteger y) {
            this.x = x;
            this.y = y;
        }
    }

    // Multiply two polynomials
    static BigInteger[] multiply(BigInteger[] a, BigInteger[] b) {
        BigInteger[] result = new BigInteger[a.length + b.length - 1];
        Arrays.fill(result, BigInteger.ZERO);

        for (int i = 0; i < a.length; i++) {
            for (int j = 0; j < b.length; j++) {
                result[i + j] = result[i + j].add(a[i].multiply(b[j]));
            }
        }
        return result;
    }

    // Add two polynomials
    static BigInteger[] add(BigInteger[] a, BigInteger[] b) {
        int max = Math.max(a.length, b.length);
        BigInteger[] result = new BigInteger[max];
        Arrays.fill(result, BigInteger.ZERO);

        for (int i = 0; i < a.length; i++)
            result[i] = result[i].add(a[i]);

        for (int i = 0; i < b.length; i++)
            result[i] = result[i].add(b[i]);

        return result;
    }

    // Lagrange Interpolation
    static BigInteger[] lagrange(List<Point> points) {

        int k = points.size();
        BigInteger[] result = new BigInteger[]{BigInteger.ZERO};

        for (int i = 0; i < k; i++) {

            BigInteger[] numerator = new BigInteger[]{BigInteger.ONE};
            BigInteger denominator = BigInteger.ONE;

            for (int j = 0; j < k; j++) {
                if (i == j) continue;

                BigInteger[] temp = new BigInteger[]{
                        points.get(j).x.negate(),
                        BigInteger.ONE
                };

                numerator = multiply(numerator, temp);

                denominator = denominator.multiply(
                        points.get(i).x.subtract(points.get(j).x)
                );
            }

            BigInteger scale = points.get(i).y.divide(denominator);

            for (int t = 0; t < numerator.length; t++) {
                numerator[t] = numerator[t].multiply(scale);
            }

            result = add(result, numerator);
        }

        return result;
    }

    public static void main(String[] args) throws Exception {

        ObjectMapper mapper = new ObjectMapper();

        // Change file name here:
        JsonNode root = mapper.readTree(new File("input1.json"));
        // For second testcase use:
        // JsonNode root = mapper.readTree(new File("input2.json"));

        int k = root.get("keys").get("k").asInt();

        List<Point> points = new ArrayList<>();

        Iterator<Map.Entry<String, JsonNode>> fields = root.fields();

        while (fields.hasNext()) {
            Map.Entry<String, JsonNode> entry = fields.next();

            if (entry.getKey().equals("keys")) continue;

            int x = Integer.parseInt(entry.getKey());
            int base = Integer.parseInt(entry.getValue().get("base").asText());
            String value = entry.getValue().get("value").asText();

            BigInteger y = new BigInteger(value, base);

            points.add(new Point(BigInteger.valueOf(x), y));
        }

        // Sort by x
        points.sort(Comparator.comparing(p -> p.x));

        // Take only first k points
        List<Point> selected = points.subList(0, k);

        BigInteger[] polynomial = lagrange(selected);

        System.out.println("Polynomial Coefficients:");

        for (int i = 0; i < polynomial.length; i++) {
            System.out.println("x^" + i + " : " + polynomial[i]);
        }
    }
}